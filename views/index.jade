doctype html
html
  head
    meta(charset='utf-8')
    title HDFS Web UI
    link(rel='icon', type='image/vnd.microsoft.icon', href='favicon.ico')
    link(rel='shortcut icon', type='image/x-icon', href='favicon.ico')
    link(rel='stylesheet', href='vendors/bootstrap/css/bootstrap.min.css')
    link(rel='stylesheet', href='resources/webapp.css')
    link(rel='stylesheet', href='ressources/webapp.styl')
    meta(name="viewport", content="width=device-width, initial-scale=1")
    script(type='text/javascript', src='vendors/jquery-1.11.1.min.js')
    script(type='text/javascript', src='vendors/bootstrap/js/bootstrap.min.js')
    script
      :coffee
        $().ready ->
          $('#successLogin').hide()
          $('.signupForm').hide()
          $('#messageOutput').hide()
          console.log 'ready'
          
          $('#login').submit (e) ->
            $this = $(this)
            user =
              username: $('#login-username').val()
              email: $('#login-email').val()
              password: $('#login-password').val()
              button: $('#btn').val()
            console.log 'user', user
            e.preventDefault()
            $.post "/login", user, (data) ->
              console.log 'data', data

              if data.mode is 'login'
                if data.success is true
                  # User login password and username is ok
                  $('#loginText').text "Username: " + data.username + " - Password: " + data.password
                  $('#msgTitle').text "Login"
                  $('#msgText').text "You are well logged"
                  $('#signin').hide()
                  $('#messageOutput').show()
                  $('#successLogin').show()
                else
                  # User login password or username is wrong
                  $('#msgTitle').text "Error"
                  $('#msgText').text "Your username or password is wrong."
                  $('#messageOutput').show()

              else if data.mode is 'signup'
                # Display signup form
                $('.signupForm').show()
                $('.signinForm').hide()
                $('#headerTitle').text "SIGN UP AND LOG"
              else if data.mode is 'signupAndLog'
                # Save and log
                if data.success is true
                  # User login password and username is ok
                  $('#loginText').text "Username: " + data.username + " - Password: " + data.password
                  $('#msgTitle').text "Login"
                  $('#msgText').text "You are well registered and logged."
                  $('#signin').hide()
                  $('#messageOutput').show()
                  $('#successLogin').show()

                else
                  $('#msgTitle').text "Error"
                  $('#msgText').text "Your username or password is already register."
                  $('#messageOutput').show()
            , 'json'
          
          $('#export').submit (e) ->
            $this = $(this)
            console.log "export submit"
            e.preventDefault()
            $.post "/export", (data) ->
              console.log "export: " + data
              if data.success is true
                $('#exportMessage').text "Data register"
                $('#exportDiv').hide()
              else 
                $('#exportMessage').text "No Data register"
            , 'json'
            
          
            
  body

    div#headerDiv
      h1#headerTitle SIGN IN

    div.jumbotron#messageOutput
      h1#msgTitle Message
      p#msgText text

    div#signin
      form.borderPadding#login(action="/login", method="post", role="form")
        table
          tr.form-group
            th
              label.signinForm(for="login-username") Username or email
              label.signupForm(for="login-username") Username
            td
              input#login-username.form-control(type='text', name="username")

          tr.form-group.signupForm
            th
              label(for="login-email") Email
            td
              input#login-email.form-control(type='text', name="email", placehoder="Mail")

          tr.form-group
            th
              label(for="login-password") Password
            td
              input#login-password.form-control(type='password', name="password")

          tr.form-group
            th
            td
              input.btn.btn-primary.signinForm#btn(type='submit', value="Login")
              input.btn.btn-default.signinForm(type='submit', value="Signup", onclick="$('#btn').val('Signup')")
              input.btn.btn-primary.signupForm(type='submit', value="Signup And Login", onclick="$('#btn').val('SignupAndLog')")


    div#successLogin
      h2 Hello
      p#loginText
      p
      h3 Export
      p#exportMessage
      div#exportDiv
        p Click to export database and logout
        form#export(action="/export", method="post", role="form")
          input.btn.btn-primary#exportBtn(type='submit', value="Export & Logout")

      

    footer
      p Â© 2014 - All rights reserved.
      p Alexandre Dejacques - Lauren Letestu - Thomas Pansart
